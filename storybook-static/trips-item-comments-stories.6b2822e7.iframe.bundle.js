"use strict";(self.webpackChunkwithme_travel=self.webpackChunkwithme_travel||[]).push([[2402,3909,4322],{"./components/trips/item-comments.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DarkMode:()=>DarkMode,Default:()=>Default,LightMode:()=>LightMode,__namedExportsOrder:()=>__namedExportsOrder,default:()=>item_comments_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),client=__webpack_require__("./utils/supabase/client.ts"),use_toast=__webpack_require__("./components/ui/use-toast.ts"),formatDistanceToNow=__webpack_require__("./node_modules/date-fns/formatDistanceToNow.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");function ItemComments({itemId,tripId,itemName="this item",maxHeight="400px",showCommentCount=!0,onNewComment}){const{toast}=(0,use_toast.dj)(),[isOpen,setIsOpen]=(0,react.useState)(!1),[isLoading,setIsLoading]=(0,react.useState)(!1),[comments,setComments]=(0,react.useState)([]),supabase=(0,client.createClient)()||null;(0,react.useEffect)((()=>{isOpen&&(async()=>{if(supabase)try{setIsLoading(!0);const{data,error}=await supabase.from("itinerary_item_comments").select("*").order("created_at",{ascending:!1});if(error)throw error;data&&Array.isArray(data)?setComments(data):setComments([])}catch(error){console.error("Error loading comments:",error),toast({title:"Failed to load comments",description:"Please try again later",variant:"destructive"})}finally{setIsLoading(!1)}})()}),[isOpen,supabase,toast]),(0,react.useEffect)((()=>{if(!isOpen||!supabase)return;const subscription=supabase.channel("item-comments").on("postgres_changes",{event:"*",schema:"public",table:"itinerary_item_comments"},(()=>{supabase.from("itinerary_item_comments").select("*").order("created_at",{ascending:!1}).then((({data,error})=>{error?console.error("Error in subscription:",error):data&&Array.isArray(data)?setComments(data):setComments([])}))})).subscribe();return()=>{supabase&&supabase.removeChannel(subscription)}}),[isOpen,supabase]);const renderComment=(0,react.useCallback)((comment=>{const timeDisplay=(0,formatDistanceToNow.m)(new Date(comment.created_at),{addSuffix:!0});return(0,jsx_runtime.jsx)("div",{className:"flex gap-3 py-3",children:(0,jsx_runtime.jsx)("div",{className:"flex-1 space-y-1",children:(0,jsx_runtime.jsx)("span",{className:"text-xs text-muted-foreground ml-2",children:timeDisplay})})},comment.id)}),[]);return(0,jsx_runtime.jsx)("div",{style:{maxHeight,overflowY:"auto"},children:isLoading?(0,jsx_runtime.jsx)("div",{children:"Loading comments..."}):comments.map(renderComment)})}ItemComments.__docgenInfo={description:"",methods:[],displayName:"ItemComments",props:{itemId:{required:!0,tsType:{name:"string"},description:""},tripId:{required:!0,tsType:{name:"string"},description:""},itemName:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'this item'",computed:!1}},maxHeight:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'400px'",computed:!1}},showCommentCount:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},onNewComment:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const item_comments_stories={title:"Product/Features/ItemComments",component:ItemComments,parameters:{layout:"centered"}},mockProps={itemId:"item-1",comments:[{id:"c1",user:{name:"Alice"},content:"Great idea!",created_at:"2024-07-01T10:00:00Z"},{id:"c2",user:{name:"Bob"},content:"Let's do it!",created_at:"2024-07-01T11:00:00Z"}],onAddComment:text=>alert("Add comment: "+text)},Default={args:{...mockProps}},LightMode={args:{...mockProps},parameters:{backgrounds:{default:"light"}}},DarkMode={args:{...mockProps},parameters:{backgrounds:{default:"dark"}}},__namedExportsOrder=["Default","LightMode","DarkMode"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  args: {\n    ...mockProps\n  }\n}",...Default.parameters?.docs?.source}}},LightMode.parameters={...LightMode.parameters,docs:{...LightMode.parameters?.docs,source:{originalSource:"{\n  args: {\n    ...mockProps\n  },\n  parameters: {\n    backgrounds: {\n      default: 'light'\n    }\n  }\n}",...LightMode.parameters?.docs?.source}}},DarkMode.parameters={...DarkMode.parameters,docs:{...DarkMode.parameters?.docs,source:{originalSource:"{\n  args: {\n    ...mockProps\n  },\n  parameters: {\n    backgrounds: {\n      default: 'dark'\n    }\n  }\n}",...DarkMode.parameters?.docs?.source}}}},"./components/ui/use-toast.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{dj:()=>useToast,oR:()=>toast});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");let count=0;const toastTimeouts=new Map,addToRemoveQueue=toastId=>{if(toastTimeouts.has(toastId))return;const timeout=setTimeout((()=>{toastTimeouts.delete(toastId),dispatch({type:"REMOVE_TOAST",toastId})}),1e6);toastTimeouts.set(toastId,timeout)},reducer=(state,action)=>{switch(action.type){case"ADD_TOAST":return{...state,toasts:[action.toast,...state.toasts].slice(0,1)};case"UPDATE_TOAST":return{...state,toasts:state.toasts.map((t=>t.id===action.toast.id?{...t,...action.toast}:t))};case"DISMISS_TOAST":{const{toastId}=action;return toastId?addToRemoveQueue(toastId):state.toasts.forEach((toast=>addToRemoveQueue(toast.id))),{...state,toasts:state.toasts.map((t=>t.id===toastId||void 0===toastId?{...t,open:!1}:t))}}case"REMOVE_TOAST":return void 0===action.toastId?{...state,toasts:[]}:{...state,toasts:state.toasts.filter((t=>t.id!==action.toastId))}}},listeners=[];let memoryState={toasts:[]};function dispatch(action){memoryState=reducer(memoryState,action),listeners.forEach((listener=>listener(memoryState)))}function toast({...props}){const id=function genId(){return count=(count+1)%Number.MAX_SAFE_INTEGER,count.toString()}(),dismiss=()=>dispatch({type:"DISMISS_TOAST",toastId:id});return dispatch({type:"ADD_TOAST",toast:{...props,id,open:!0,onOpenChange:open=>{open||dismiss()}}}),{id,dismiss,update:props=>dispatch({type:"UPDATE_TOAST",toast:{...props,id}})}}function useToast(){const[state,setState]=react__WEBPACK_IMPORTED_MODULE_0__.useState(memoryState);return react__WEBPACK_IMPORTED_MODULE_0__.useEffect((()=>(listeners.push(setState),()=>{const index=listeners.indexOf(setState);index>-1&&listeners.splice(index,1)})),[state]),{...state,toast,dismiss:toastId=>dispatch({type:"DISMISS_TOAST",toastId})}}},"./utils/supabase/browser-client.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{getBrowserClient:()=>getBrowserClient,resetBrowserClient:()=>resetBrowserClient});var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@supabase/ssr/dist/module/index.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");let browserClient=null;function getBrowserClient(){if(browserClient)return browserClient;const supabaseAnonKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";return browserClient=(0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createBrowserClient)("http://localhost:54321",supabaseAnonKey,{global:{headers:{Accept:"application/json"}},auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1}}),browserClient}function resetBrowserClient(){console.log("[supabase] Resetting browser client singleton"),browserClient=null}},"./utils/supabase/client.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{createClient:()=>createClient,kT:()=>createBrowserClient});var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@supabase/supabase-js/dist/module/index.js");__webpack_require__("./utils/supabase/browser-client.ts");const supabaseUrl="http://localhost:54321",supabaseAnonKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";if(!supabaseUrl||!supabaseAnonKey)throw new Error("Missing Supabase environment variables (URL or Anon Key).");let clientSingleton=null;function createClient(){return clientSingleton||(clientSingleton=(0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.UU)(supabaseUrl,supabaseAnonKey),clientSingleton)}function createBrowserClient(){return(0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.UU)(supabaseUrl,supabaseAnonKey)}}}]);